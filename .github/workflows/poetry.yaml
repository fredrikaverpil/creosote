name: poetry

on:
  schedule:
    - cron: "0 9 * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v3
        with:
          python-version: "3.10"
      - uses: fredrikaverpil/setup-pipx@v1.5
      - run: pipx install poetry
      - uses: fredrikaverpil/poetry-update@v1.2
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          delete-branch: true
          branch: poetry-update
          add-paths: |
            poetry.lock
          commit-message: "Update poetry dependencies"
          title: "Update poetry dependencies"
          body: |
            :warning: There is a risk that some production dependencies which are sub-dependencies of developer dependencies can be updated by this action. Always review `poetry.lock` carefully.

            ### Updated dependencies:

            ```bash
            ${{ env.POETRY_UPDATED }}
            ```

            ### Outdated dependencies _before_ this PR:

            ```bash
            ${{ env.POETRY_OUTDATED_BEFORE }}
            ```

            ### Outdated dependencies _after_ this PR:

            ```bash
            ${{ env.POETRY_OUTDATED_AFTER }}
            ```

            :pencil2: There may be dependencies in the table above which were not updated as part of this PR. The reason is they require manual updating due to the way they are pinned._
